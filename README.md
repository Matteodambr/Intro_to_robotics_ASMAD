# Simscape Manipulator Example (KUKA iiwa 7)


[![MATLAB R2025b](https://img.shields.io/badge/MATLAB-R2025b+-800080?logo=matlab&logoColor=white)](#requirements)
[![Robotics System Toolbox](https://img.shields.io/badge/Robotics%20System%20Toolbox-Required-3f51b5)](#requirements)
[![Simulink](https://img.shields.io/badge/Simulink-Required-3f51b5)](#requirements)
[![Simscape Multibody](https://img.shields.io/badge/Simscape%20Multibody-Required-3f51b5)](#requirements)
[![Latest Release](https://img.shields.io/github/v/release/Matteodambr/SimscapeManipulator_example?sort=semver)](https://github.com/Matteodambr/SimscapeManipulator_example/releases)
[![Last Commit](https://img.shields.io/github/last-commit/Matteodambr/SimscapeManipulator_example?color=14b8a6)](https://github.com/Matteodambr/SimscapeManipulator_example/commits)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)

These scripts are part of the material for the course "Applied Space Mission Analysis and Design" in the Space Engineering MSc program at Politecnico di Milano. They are intended for educational use to support the lecture on robotic manipulators, kinematics, and simulation.

---

This repository contains a compact MATLAB/Simulink example that demonstrates how to:

- Work with a KUKA iiwa 7-DOF manipulator using Robotics System Toolbox
- Compute forward/direct and inverse kinematics for a target end‑effector pose
- Sample and visualize an approximate workspace and manipulability
- Run a Simscape Multibody simulation of the robot tracking a target configuration
- Automatically export all figures as PNG images

The main script is `main_exampleManipulator.m`.

---

## What the script does

1. Load the robot model
   - Loads the prebuilt KUKA iiwa 7 model via `loadrobot('kukaiiwa7')`.
   - Alternatively (commented lines in the script): import from `RBT_kuka.urdf`, or export a `rigidBodyTree` to URDF.

2. Show the robot in the home configuration
   - Displays the manipulator and sets axis limits/labels.
   - Finds the end-effector body name from the `rigidBodyTree`.

3. Direct (forward) kinematics at home
   - Computes the homogeneous transform T_home, extracting position and rotation (DCM) of the end-effector.

4. Inverse kinematics to a target pose
   - Defines a target end-effector pose (position and orientation).
   - Solves IK with an optimization-based solver (Levenberg–Marquardt) starting from home.
   - Asserts convergence and prints a table comparing the initial guess vs the IK solution (in degrees).
   - Verifies the solution by recomputing forward kinematics and checking it matches the target pose.
   - Visualizes the target configuration.

5. Workspace and manipulability analysis
   - Randomly samples configurations to approximate the reachable workspace and visualizes it via an alpha shape.
   - Computes the Yoshikawa manipulability index on sampled points and visualizes it in 3D.
   - Builds a local manipulability map around the chosen target pose in the Y–Z plane by:
     - Solving IK on a small grid near the target
     - Computing the geometric Jacobian singular values and their product
     - Plotting reachable points color-coded by manipulability

6. Simscape Multibody closed-loop control (simscape_kuka.slx)
   - Prepares variables `initial_configuration` and `final_configuration` for the Simulink model.
   - Adds the `Meshes/` folder to the MATLAB path and links STL meshes to Simscape File Solid blocks automatically.
   - Sets simple diagonal gains (Kp, Kd, Ki=0) for a joint-space controller defined in the model.
   - Runs the Simulink model `simscape_kuka.slx` in normal mode.
   - Plots the control torques `tau_control` over time.

7. Figure export
   - Saves all open figures as `figure_XX.png` at 300 DPI in the repository root.

---

## Repository structure

- `main_exampleManipulator.m` — End-to-end demo script described above
- `simscape_kuka.slx` — Simscape Multibody model used by the script
- `simulink_inverse_kinematics.slx` — Auxiliary Simulink example (not invoked by the main script)
- `RBT_kuka.urdf` — Example URDF for the KUKA iiwa 7 (optional path for import)
- `Meshes/` — STL meshes for links `link_0.stl` … `link_7.stl`
- `figure_*.png` — Images auto-generated by running the script
- `LICENSE` — MIT License

---

## Requirements

MATLAB toolboxes:

- Robotics System Toolbox (rigidBodyTree, inverseKinematics, geometricJacobian, etc.)
- Simulink
- Simscape Multibody

---

## Customization tips

- Change the IK target pose: edit `EE_target_POS` and `EE_target_DCM` near the top of the IK section.
- Tuning IK: adjust the `weight` vector (rotation/translation weighting) and solver type/tolerances.
- Workspace density: change the sampling size/grid parameters (e.g., `samples_per_axis`, `grid_size`).
- Simulation gains: update `K_P`, `K_D`, and `K_I` to experiment with different controller behavior.
- Meshes: STL files are auto-linked to Simscape File Solid blocks via block names `iiwa_link_<idx>`; make sure your block names and files match if you change the model.

---

## Outputs

- Interactive MATLAB figures for kinematics, workspace, and manipulability
- Simulink plot of control torques (if Simscape model is run)

---

## License

This project is licensed under the MIT License — see `LICENSE` for details.
